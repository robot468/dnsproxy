#!/bin/sh
set -e
OS=`uname -s`
CFLAGS="-Wall -O2 -D_GNU_SOURCE"
LDFLAGS="-levent -pthread"

# Verify that libevent headers are available
CC_CMD=${CC:-cc}
if ! printf '#include <event2/event.h>\n' | "$CC_CMD" -E - >/dev/null 2>&1; then
    echo "libevent headers not found. Please install libevent development files." >&2
    exit 1
fi

if [ "$OS" = "Linux" ]; then
    : # defaults are fine
else
    CFLAGS="$CFLAGS -I/usr/local/include -I/usr/local/include/event2"
    LDFLAGS="-L/usr/local/lib $LDFLAGS"
fi
sed -e "s|@CFLAGS@|$CFLAGS|" -e "s|@LDFLAGS@|$LDFLAGS|" Makefile.in > Makefile
chmod +x Makefile
echo "Configured for $OS"
